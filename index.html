<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Sender</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Admin Sender</h1>

<input id="itemInput" placeholder="Type item and press Enter">
<div id="items"></div>

<script>
let items = [];

// Render items on page
function renderItems() {
  const itemsDiv = document.getElementById('items');
  itemsDiv.innerHTML = '';
  items.forEach((item,index) => {
    const div = document.createElement('div');
    div.className = 'item-box';
    div.innerHTML = `<span>${item}</span><button>Delete</button>`;
    div.querySelector('button').onclick = () => {
      items.splice(index,1);
      renderItems();
    };
    itemsDiv.appendChild(div);
  });
}

// Handle input
document.getElementById('itemInput').addEventListener('keypress', e => {
  if(e.key === 'Enter'){
    const val = e.target.value.trim();
    if(!val) return;
    items.push(val);
    renderItems();
    e.target.value = '';
    sendItems(); // send to kiosk endpoint
  }
});

// Send items to /items.json
async function sendItems(){
  try {
    await fetch('/items.json', {
      method: 'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({items})
    });
  } catch(e){ console.error(e); }
}

// Poll /selected for kiosk selections
async function pollSelection(){
  try{
    const res = await fetch('/selected');
    if(res.ok){
      const data = await res.json();
      if(data.selected){
        alert(`Item selected: ${data.selected}`);
        // optionally clear selection after processing
        await fetch('/selected',{method:'DELETE'});
      }
    }
  }catch(e){ console.error(e); }
  setTimeout(pollSelection,2000);
}

renderItems();
pollSelection();
</script>
</body>
</html>
